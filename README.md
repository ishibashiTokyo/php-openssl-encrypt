# php-openssl-encrypt
Hidden commands using OpenSSL

POST内容を秘密鍵、公開鍵を使用して暗号、複合化して通信を行う。

SSLに対応していないサイトであったり、WAFによる監視を回避するために使用。

また、複合化できない場合は処理を中断することで認証としても使用可能。


server.phpでのスクリーンショット

![img/image.png](img/image.png)

```sh
$ php key-gen.php
```
を実行して生成された鍵をserver.phpと、client.phpの変数に書き換えて使用してください。

memo:

```sh
string(54) "error:0906D06C:PEM routines:PEM_read_bio:no start line"
```
`openssl_public_encrypt()`で第一引数の文字列に変な記号があると鍵ファイルの読み込みができなくなる模様。


## RSA暗号化における鍵サイズから-11する理由

openssl_public_encrypt関数で暗号化可能なデータの長さは、鍵サイズから一定の値を引いた値になります。
この-11という値は、OpenSSLにおけるRSA暗号化の内部処理に由来しており、パディング方式やオーバーヘッドによって決まります。

### -11の理由を深掘り
- パディング: RSA暗号では、平文を暗号化するためにパディングを行います。このパディング情報が、暗号化データのサイズに影響を与えます。
- オーバーヘッド: 暗号化処理には、パディング以外にも、アルゴリズム固有のオーバーヘッドが発生します。
- OpenSSLの実装: OpenSSLの実装では、これらの要素を考慮して、暗号化可能な最大サイズを計算しています。

具体的には、以下のような要素が考えられます。

- PKCS#1 v1.5パディング: 一般的に使用されるパディング方式ですが、パディング情報によって、暗号化可能なデータサイズが制限されます。
- RSA鍵の形式: RSA鍵には、様々な形式が存在し、それぞれ暗号化可能なデータサイズが異なります。
- OpenSSLのバージョン: OpenSSLのバージョンによって、内部処理が異なる場合があります。

### -11の値は固定ではない

-11という値は、あくまでもOpenSSLにおける一般的な値であり、必ずしも固定ではありません。
使用するパディング方式やRSA鍵の形式、OpenSSLのバージョンによって異なる場合があります。

### 安全な暗号化のために

- 最大暗号化可能サイズ: 暗号化前に、必ずopenssl_cipher_iv_length関数を使用して、最大暗号化可能サイズを確認することを推奨します。
- パディング: パディング方式は、暗号化の安全性に影響を与えるため、適切な方式を選択する必要があります。
- エラー処理: 暗号化処理中にエラーが発生した場合、適切なエラー処理を行う必要があります。